<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø§ÙƒÙŠ ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }

        .portfolio-summary {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .profit { color: #4CAF50; }
        .loss { color: #f44336; }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-btn, .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover, .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .filter-btn.active {
            background: #4CAF50;
        }

        .stocks-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .stock-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            align-items: center;
        }

        .stock-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-5px);
        }

        .stock-name {
            font-weight: bold;
        }

        .stock-symbol {
            font-size: 11px;
            opacity: 0.7;
        }

        .stock-price {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
        }

        .stock-change {
            text-align: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .news-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 3px solid #2196F3;
        }

        .news-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .news-meta {
            font-size: 11px;
            opacity: 0.6;
            display: flex;
            justify-content: space-between;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .order-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 14px;
            opacity: 0.9;
        }

        input, select {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .order-summary {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-buy {
            background: #4CAF50;
            color: #fff;
        }

        .btn-buy:hover {
            background: #45a049;
        }

        .btn-sell {
            background: #f44336;
            color: #fff;
        }

        .btn-sell:hover {
            background: #da190b;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .holdings-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .holding-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            align-items: center;
        }

        .challenges {
            margin-top: 20px;
        }

        .challenge-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 3px solid #FF9800;
        }

        .challenge-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            background: #4CAF50;
            height: 100%;
            transition: width 0.3s;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #4CAF50;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .order-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cancel-order-btn {
            padding: 6px 12px;
            background: #f44336;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stock-item {
                grid-template-columns: 1fr;
            }

            .portfolio-summary {
                gap: 15px;
            }
        }

        .time-display {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .impact-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 5px;
        }

        .impact-high { background: #f44336; }
        .impact-medium { background: #FF9800; }
        .impact-low { background: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸ“ˆ Ù…Ø­Ø§ÙƒÙŠ ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
            <div class="portfolio-summary">
                <div class="stat">
                    <div class="stat-label">Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„</div>
                    <div class="stat-value" id="cashDisplay">50,000</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
                    <div class="stat-value" id="portfolioValue">50,000</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­/Ø§Ù„Ø®Ø³Ø§Ø¦Ø±</div>
                    <div class="stat-value" id="plDisplay">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ %</div>
                    <div class="stat-value" id="returnDisplay">0%</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <div class="panel-header">ğŸ“Š Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
                
                <div class="time-display">
                    <div style="font-size: 14px; opacity: 0.7;">ÙˆÙ‚Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„</div>
                    <div id="marketTime" style="font-size: 20px; font-weight: bold;">10:00 ØµØ¨Ø§Ø­Ø§Ù‹</div>
                    <div id="marketDay" style="font-size: 12px; opacity: 0.6;">Ø§Ù„ÙŠÙˆÙ… 1</div>
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterStocks('all')">Ø§Ù„ÙƒÙ„</button>
                    <button class="filter-btn" onclick="filterStocks('banks')">Ø§Ù„Ø¨Ù†ÙˆÙƒ</button>
                    <button class="filter-btn" onclick="filterStocks('petrochemical')">Ø§Ù„Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª</button>
                    <button class="filter-btn" onclick="filterStocks('telecom')">Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª</button>
                    <button class="filter-btn" onclick="filterStocks('retail')">Ø§Ù„ØªØ¬Ø²Ø¦Ø©</button>
                    <button class="filter-btn" onclick="filterStocks('insurance')">Ø§Ù„ØªØ£Ù…ÙŠÙ†</button>
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³Ù‡Ù…..." style="flex: 1; min-width: 200px;" oninput="searchStocks()">
                </div>

                <div class="stocks-list scrollbar" id="stocksList"></div>
            </div>

            <div>
                <div class="panel">
                    <div class="panel-header">ğŸ“° Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø«</div>
                    <div id="newsList" class="scrollbar" style="max-height: 300px; overflow-y: auto;"></div>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <div class="panel-header">ğŸ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</div>
                    <div id="challengesList"></div>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <div class="panel-header">ğŸ’¼ Ù…Ø­ÙØ¸ØªÙŠ</div>
                    <div id="holdingsList"></div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('orders')">Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</button>
                <button class="tab-btn" onclick="switchTab('history')">Ø³Ø¬Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª</button>
            </div>
            <div id="ordersTab" class="tab-content active">
                <div id="pendingOrdersList"></div>
            </div>
            <div id="historyTab" class="tab-content">
                <div id="tradeHistoryList" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="tradeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø³Ù‡Ù…</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>

            <div class="chart-container">
                <canvas id="stockChart"></canvas>
            </div>

            <form class="order-form" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±</label>
                    <select id="orderType" onchange="updateOrderForm()">
                        <option value="market">Ø£Ù…Ø± Ø³ÙˆÙ‚ (ØªÙ†ÙÙŠØ° ÙÙˆØ±ÙŠ)</option>
                        <option value="limit">Ø£Ù…Ø± Ù…Ø­Ø¯Ø¯ (Ø¨Ø³Ø¹Ø± Ù…Ø¹ÙŠÙ†)</option>
                    </select>
                </div>

                <div class="form-group" id="limitPriceGroup" style="display: none;">
                    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯</label>
                    <input type="number" id="limitPrice" step="0.01" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±">
                </div>

                <div class="form-group">
                    <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                    <input type="number" id="quantity" min="1" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ù‡Ù…" required oninput="updateOrderSummary()">
                </div>

                <div class="order-summary">
                    <div class="summary-row">
                        <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                        <span id="currentPrice">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
                        <span id="totalValue">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© (0.155%):</span>
                        <span id="commission">0</span>
                    </div>
                    <div class="summary-row" style="font-weight: bold; font-size: 18px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px; margin-top: 10px;">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                        <span id="finalTotal">0</span>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn-primary btn-buy" data-action="buy">Ø´Ø±Ø§Ø¡</button>
                    <button type="submit" class="btn-primary btn-sell" data-action="sell">Ø¨ÙŠØ¹</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const SECTORS = {
            banks: 'Ø§Ù„Ø¨Ù†ÙˆÙƒ',
            petrochemical: 'Ø§Ù„Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª',
            telecom: 'Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª',
            retail: 'Ø§Ù„ØªØ¬Ø²Ø¦Ø©',
            insurance: 'Ø§Ù„ØªØ£Ù…ÙŠÙ†',
            cement: 'Ø§Ù„Ø£Ø³Ù…Ù†Øª',
            energy: 'Ø§Ù„Ø·Ø§Ù‚Ø©',
            realestate: 'Ø§Ù„Ø¹Ù‚Ø§Ø±',
            transport: 'Ø§Ù„Ù†Ù‚Ù„',
            media: 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…',
            hotels: 'Ø§Ù„ÙÙ†Ø§Ø¯Ù‚',
            agriculture: 'Ø§Ù„Ø²Ø±Ø§Ø¹Ø©',
            industrial: 'Ø§Ù„ØµÙ†Ø§Ø¹Ø©',
            building: 'Ø§Ù„ØªØ´ÙŠÙŠØ¯'
        };

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (Ø¹ÙŠÙ†Ø© Ù…Ù† 100 Ø´Ø±ÙƒØ© - ÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹Ù‡Ø§)
        const STOCKS = [
            // Ø§Ù„Ø¨Ù†ÙˆÙƒ
            {symbol: '1180', name: 'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ', sector: 'banks', basePrice: 85.5, mu: 0.0002, sigma: 0.015},
            {symbol: '1120', name: 'Ø§Ù„Ø£Ù‡Ù„ÙŠ', sector: 'banks', basePrice: 32.4, mu: 0.0001, sigma: 0.012},
            {symbol: '1010', name: 'Ø§Ù„Ø±ÙŠØ§Ø¶', sector: 'banks', basePrice: 28.3, mu: 0.0001, sigma: 0.013},
            {symbol: '1050', name: 'Ø§Ù„Ø¬Ø²ÙŠØ±Ø©', sector: 'banks', basePrice: 16.8, mu: 0.0001, sigma: 0.014},
            {symbol: '1080', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠ', sector: 'banks', basePrice: 34.2, mu: 0.0001, sigma: 0.012},
            {symbol: '1060', name: 'Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡', sector: 'banks', basePrice: 22.5, mu: 0.0002, sigma: 0.013},
            {symbol: '1140', name: 'Ø§Ù„Ø¨Ù„Ø§Ø¯', sector: 'banks', basePrice: 25.7, mu: 0.0001, sigma: 0.015},
            {symbol: '1150', name: 'Ø³Ø§Ø¨', sector: 'banks', basePrice: 31.9, mu: 0.0001, sigma: 0.011},
            {symbol: '1030', name: 'Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±', sector: 'banks', basePrice: 18.4, mu: 0.0001, sigma: 0.013},
            {symbol: '1020', name: 'Ø³Ø§Ù…Ø¨Ø§', sector: 'banks', basePrice: 29.6, mu: 0.0001, sigma: 0.012},
            
            // Ø§Ù„Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª
            {symbol: '2010', name: 'Ø³Ø§Ø¨Ùƒ', sector: 'petrochemical', basePrice: 98.2, mu: 0.0003, sigma: 0.018},
            {symbol: '2020', name: 'Ø³Ø§Ø¨Ùƒ Ù„Ù„Ù…ØºØ°ÙŠØ§Øª', sector: 'petrochemical', basePrice: 124.5, mu: 0.0002, sigma: 0.02},
            {symbol: '2170', name: 'Ø§Ù„Ù„Ø¬ÙŠÙ†', sector: 'petrochemical', basePrice: 42.8, mu: 0.0002, sigma: 0.019},
            {symbol: '2220', name: 'Ù…Ø¹Ø§Ø¯Ù†', sector: 'petrochemical', basePrice: 47.3, mu: 0.0003, sigma: 0.021},
            {symbol: '2090', name: 'Ø§Ù„Ø¬Ø¨ÙŠÙ„', sector: 'petrochemical', basePrice: 24.6, mu: 0.0001, sigma: 0.017},
            {symbol: '2030', name: 'Ø³Ø§ÙÙƒÙˆ', sector: 'petrochemical', basePrice: 112.8, mu: 0.0002, sigma: 0.018},
            {symbol: '2350', name: 'ÙƒÙŠÙ…Ø§Ù†ÙˆÙ„', sector: 'petrochemical', basePrice: 15.4, mu: 0.0001, sigma: 0.016},
            {symbol: '2060', name: 'Ø§Ù„ØªØµÙ†ÙŠØ¹', sector: 'petrochemical', basePrice: 34.2, mu: 0.0002, sigma: 0.017},
            {symbol: '2290', name: 'ÙŠÙ†Ø³Ø§Ø¨', sector: 'petrochemical', basePrice: 58.7, mu: 0.0002, sigma: 0.019},
            {symbol: '2380', name: 'Ø¨ØªØ±ÙˆÙƒÙŠÙ…', sector: 'petrochemical', basePrice: 22.1, mu: 0.0001, sigma: 0.016},
            
            // Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª
            {symbol: '7010', name: 'Ø§ØªØµØ§Ù„Ø§Øª', sector: 'telecom', basePrice: 44.8, mu: 0.0002, sigma: 0.014},
            {symbol: '7020', name: 'Ù…ÙˆØ¨Ø§ÙŠÙ„ÙŠ', sector: 'telecom', basePrice: 29.4, mu: 0.0001, sigma: 0.016},
            {symbol: '7030', name: 'Ø²ÙŠÙ†', sector: 'telecom', basePrice: 16.2, mu: 0.0001, sigma: 0.015},
            {symbol: '7040', name: 'Ø¹Ø°ÙŠØ¨', sector: 'telecom', basePrice: 87.3, mu: 0.0002, sigma: 0.013},
            
            // Ø§Ù„ØªØ¬Ø²Ø¦Ø©
            {symbol: '4001', name: 'Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©', sector: 'retail', basePrice: 32.7, mu: 0.0002, sigma: 0.016},
            {symbol: '4008', name: 'Ø³Ø§ÙƒÙˆ', sector: 'retail', basePrice: 56.9, mu: 0.0003, sigma: 0.018},
            {symbol: '4050', name: 'Ø³Ø§Ø³ÙƒÙˆ', sector: 'retail', basePrice: 48.3, mu: 0.0002, sigma: 0.017},
            {symbol: '4190', name: 'Ø¬Ø±ÙŠØ±', sector: 'retail', basePrice: 142.6, mu: 0.0003, sigma: 0.015},
            {symbol: '4191', name: 'Ø£Ø¨Ùˆ Ù…Ø¹Ø·ÙŠ', sector: 'retail', basePrice: 34.8, mu: 0.0001, sigma: 0.016},
            {symbol: '4240', name: 'Ø§Ù„Ù†Ù‡Ø¯ÙŠ', sector: 'retail', basePrice: 87.5, mu: 0.0004, sigma: 0.019},
            {symbol: '4280', name: 'Ø§Ù„Ù…ÙˆØ§Ø³Ø§Ø©', sector: 'retail', basePrice: 156.2, mu: 0.0003, sigma: 0.017},
            {symbol: '4031', name: 'Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠØ©', sector: 'retail', basePrice: 64.3, mu: 0.0002, sigma: 0.015},
            
            // Ø§Ù„ØªØ£Ù…ÙŠÙ†
            {symbol: '8010', name: 'Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠØ©', sector: 'insurance', basePrice: 42.1, mu: 0.0001, sigma: 0.016},
            {symbol: '8012', name: 'Ø¬Ø²ÙŠØ±Ø© ØªÙƒØ§ÙÙ„', sector: 'insurance', basePrice: 28.4, mu: 0.0001, sigma: 0.015},
            {symbol: '8020', name: 'Ù…Ù„Ø§Ø° Ù„Ù„ØªØ£Ù…ÙŠÙ†', sector: 'insurance', basePrice: 18.7, mu: 0.0001, sigma: 0.017},
            {symbol: '8030', name: 'Ù…ÙŠØ¯ØºÙ„Ù', sector: 'insurance', basePrice: 34.9, mu: 0.0001, sigma: 0.014},
            {symbol: '8040', name: 'Ø£Ù„ÙŠØ§Ù†Ø²', sector: 'insurance', basePrice: 52.3, mu: 0.0002, sigma: 0.015},
            {symbol: '8050', name: 'Ø³Ù„Ø§Ù…Ø©', sector: 'insurance', basePrice: 26.8, mu: 0.0001, sigma: 0.016},
            {symbol: '8060', name: 'ÙˆÙ„Ø§Ø¡', sector: 'insurance', basePrice: 45.2, mu: 0.0002, sigma: 0.014},
            {symbol: '8070', name: 'Ø§Ù„Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠ', sector: 'insurance', basePrice: 38.6, mu: 0.0001, sigma: 0.015},
            
            // Ø§Ù„Ø£Ø³Ù…Ù†Øª
            {symbol: '3010', name: 'Ø£Ø³Ù…Ù†Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', sector: 'cement', basePrice: 54.8, mu: 0.0001, sigma: 0.014},
            {symbol: '3020', name: 'Ø£Ø³Ù…Ù†Øª Ø§Ù„ÙŠÙ…Ø§Ù…Ø©', sector: 'cement', basePrice: 47.2, mu: 0.0001, sigma: 0.013},
            {symbol: '3030', name: 'Ø£Ø³Ù…Ù†Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ©', sector: 'cement', basePrice: 62.5, mu: 0.0001, sigma: 0.015},
            {symbol: '3040', name: 'Ø£Ø³Ù…Ù†Øª Ø§Ù„Ù‚ØµÙŠÙ…', sector: 'cement', basePrice: 58.3, mu: 0.0001, sigma: 0.014},
            {symbol: '3050', name: 'Ø£Ø³Ù…Ù†Øª ÙŠÙ†Ø¨Ø¹', sector: 'cement', basePrice: 43.7, mu: 0.0001, sigma: 0.013},
            {symbol: '3060', name: 'Ø£Ø³Ù…Ù†Øª Ø§Ù„Ø¬Ù†ÙˆØ¨', sector: 'cement', basePrice: 51.4, mu: 0.0001, sigma: 0.014},
            {symbol: '3090', name: 'Ø£Ø³Ù…Ù†Øª ØªØ¨ÙˆÙƒ', sector: 'cement', basePrice: 18.9, mu: 0.0001, sigma: 0.016},
            {symbol: '3091', name: 'Ø£Ø³Ù…Ù†Øª Ø§Ù„Ø¬ÙˆÙ', sector: 'cement', basePrice: 14.2, mu: 0.0001, sigma: 0.015},
            
            // Ø§Ù„Ø·Ø§Ù‚Ø©
            {symbol: '2222', name: 'Ø£Ø±Ø§Ù…ÙƒÙˆ', sector: 'energy', basePrice: 28.45, mu: 0.0002, sigma: 0.012},
            {symbol: '4030', name: 'Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡', sector: 'energy', basePrice: 23.8, mu: 0.0001, sigma: 0.011},
            {symbol: '2082', name: 'Ø£ÙƒÙˆØ§ Ø¨Ø§ÙˆØ±', sector: 'energy', basePrice: 156.2, mu: 0.0003, sigma: 0.019},
            {symbol: '5110', name: 'Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª', sector: 'energy', basePrice: 34.6, mu: 0.0001, sigma: 0.014},
            
            // Ø§Ù„Ø¹Ù‚Ø§Ø±
            {symbol: '4300', name: 'Ø¯Ø§Ø± Ø§Ù„Ø£Ø±ÙƒØ§Ù†', sector: 'realestate', basePrice: 12.4, mu: 0.0002, sigma: 0.018},
            {symbol: '4320', name: 'Ø§Ù„Ø£Ù†Ø¯Ù„Ø³', sector: 'realestate', basePrice: 28.7, mu: 0.0001, sigma: 0.016},
            {symbol: '4100', name: 'Ù…ÙƒØ©', sector: 'realestate', basePrice: 47.3, mu: 0.0002, sigma: 0.017},
            {symbol: '4150', name: 'Ø§Ù„ØªØ¹Ù…ÙŠØ±', sector: 'realestate', basePrice: 18.9, mu: 0.0001, sigma: 0.015},
            {symbol: '4220', name: 'Ø¥Ø¹Ù…Ø§Ø±', sector: 'realestate', basePrice: 13.6, mu: 0.0001, sigma: 0.019},
            {symbol: '4090', name: 'Ø·ÙŠØ¨Ø©', sector: 'realestate', basePrice: 31.2, mu: 0.0001, sigma: 0.016},
            {symbol: '4250', name: 'Ø¬Ø¨Ù„ Ø¹Ù…Ø±', sector: 'realestate', basePrice: 24.8, mu: 0.0002, sigma: 0.017},
            
            // Ø§Ù„Ù†Ù‚Ù„
            {symbol: '4110', name: 'Ø¨Ø¯Ø¬Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', sector: 'transport', basePrice: 67.4, mu: 0.0002, sigma: 0.015},
            {symbol: '4260', name: 'Ø¨ÙˆØ¨Ø§ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', sector: 'transport', basePrice: 134.8, mu: 0.0003, sigma: 0.016},
            {symbol: '2190', name: 'Ø³ÙŠØ³ÙƒÙˆ', sector: 'transport', basePrice: 42.3, mu: 0.0001, sigma: 0.014},
            {symbol: '4261', name: 'Ø°ÙŠØ¨', sector: 'transport', basePrice: 58.9, mu: 0.0002, sigma: 0.017},
            
            // Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…
            {symbol: '4210', name: 'Ø£Ø¨Ø­Ø±', sector: 'media', basePrice: 26.4, mu: 0.0001, sigma: 0.015},
            {symbol: '4070', name: 'Ø§Ù„Ø£Ø¨Ø­Ø§Ø«', sector: 'media', basePrice: 189.2, mu: 0.0002, sigma: 0.014},
            {symbol: '4200', name: 'Ø§Ù„Ø¯Ø±ÙŠØ³', sector: 'media', basePrice: 92.7, mu: 0.0003, sigma: 0.016},
            
            // Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ø³ÙŠØ§Ø­Ø©
            {symbol: '4170', name: 'Ø´Ù…Ø³', sector: 'hotels', basePrice: 74.3, mu: 0.0002, sigma: 0.017},
            {symbol: '4164', name: 'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©', sector: 'hotels', basePrice: 38.5, mu: 0.0001, sigma: 0.016},
            {symbol: '4143', name: 'Ø§Ù„Ø­ÙƒÙŠØ±', sector: 'hotels', basePrice: 54.8, mu: 0.0002, sigma: 0.018},
            
            // Ø§Ù„Ø²Ø±Ø§Ø¹Ø© ÙˆØ§Ù„Ø£ØºØ°ÙŠØ©
            {symbol: '2280', name: 'Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ', sector: 'agriculture', basePrice: 58.4, mu: 0.0003, sigma: 0.015},
            {symbol: '6010', name: 'Ù†Ø§Ø¯Ùƒ', sector: 'agriculture', basePrice: 32.8, mu: 0.0001, sigma: 0.016},
            {symbol: '6020', name: 'Ø¬Ø§ÙƒÙˆ', sector: 'agriculture', basePrice: 48.2, mu: 0.0002, sigma: 0.017},
            {symbol: '6040', name: 'ØªØ¨ÙˆÙƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©', sector: 'agriculture', basePrice: 24.6, mu: 0.0001, sigma: 0.015},
            {symbol: '6050', name: 'Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ', sector: 'agriculture', basePrice: 67.3, mu: 0.0002, sigma: 0.018},
            {symbol: '2270', name: 'Ø³Ø¯Ø§ÙÙƒÙˆ', sector: 'agriculture', basePrice: 45.7, mu: 0.0002, sigma: 0.016},
            {symbol: '6060', name: 'Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ù„Ù„ØªÙ†Ù…ÙŠØ©', sector: 'agriculture', basePrice: 19.8, mu: 0.0001, sigma: 0.014},
            
            // Ø§Ù„ØµÙ†Ø§Ø¹Ø©
            {symbol: '2040', name: 'Ø§Ù„Ø®Ø²Ù', sector: 'industrial', basePrice: 28.4, mu: 0.0001, sigma: 0.015},
            {symbol: '2050', name: 'Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØ§ÙÙˆÙ„Ø§', sector: 'industrial', basePrice: 34.2, mu: 0.0002, sigma: 0.014},
            {symbol: '2080', name: 'ØºØ§Ø²ÙƒÙˆ', sector: 'industrial', basePrice: 18.7, mu: 0.0001, sigma: 0.013},
            {symbol: '2150', name: 'Ø²Ø¬Ø§Ø¬', sector: 'industrial', basePrice: 43.6, mu: 0.0001, sigma: 0.016},
            {symbol: '2160', name: 'Ø£Ù…ÙŠØ§Ù†ØªÙŠØª', sector: 'industrial', basePrice: 56.9, mu: 0.0002, sigma: 0.015},
            {symbol: '2180', name: 'ÙÙŠØ¨ÙƒÙˆ', sector: 'industrial', basePrice: 24.3, mu: 0.0001, sigma: 0.014},
            {symbol: '2310', name: 'Ø³Ø¨ÙƒÙŠÙ…', sector: 'industrial', basePrice: 87.4, mu: 0.0003, sigma: 0.018},
            {symbol: '2320', name: 'Ø§Ù„Ø¨Ø­Ø±ÙŠ', sector: 'industrial', basePrice: 21.6, mu: 0.0001, sigma: 0.016},
            {symbol: '2330', name: 'Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©', sector: 'industrial', basePrice: 94.2, mu: 0.0003, sigma: 0.019},
            {symbol: '1211', name: 'Ù…Ø¹Ø§Ø¯Ù†', sector: 'industrial', basePrice: 42.8, mu: 0.0002, sigma: 0.017},
            
            // Ø§Ù„ØªØ´ÙŠÙŠØ¯ ÙˆØ§Ù„Ø¨Ù†Ø§Ø¡
            {symbol: '3008', name: 'Ø§Ù„ÙƒØ«ÙŠØ±ÙŠ', sector: 'building', basePrice: 38.9, mu: 0.0001, sigma: 0.015},
            {symbol: '4130', name: 'Ø§Ù„Ø¨Ø§Ø­Ø©', sector: 'building', basePrice: 27.4, mu: 0.0001, sigma: 0.014},
            {symbol: '4160', name: 'Ø«Ù…Ø§Ø±', sector: 'building', basePrice: 16.8, mu: 0.0001, sigma: 0.016},
            {symbol: '4330', name: 'Ø±ÙŠØ¯Ø§Ù†', sector: 'building', basePrice: 12.3, mu: 0.0002, sigma: 0.019},
            {symbol: '4342', name: 'Ø£Ù†Ø§Ø¨ÙŠØ¨', sector: 'building', basePrice: 34.7, mu: 0.0001, sigma: 0.014}
        ];

        // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        let gameState = {
            cash: 50000,
            holdings: {},
            pendingOrders: [],
            tradeHistory: [],
            day: 1,
            hour: 10,
            startCapital: 50000,
            challenges: [
                {id: 1, title: 'Ø­Ù‚Ù‚ 10% Ø±Ø¨Ø­', target: 55000, reward: 0, completed: false},
                {id: 2, title: 'Ø­Ù‚Ù‚ 20% Ø±Ø¨Ø­', target: 60000, reward: 100000, completed: false},
                {id: 3, title: 'Ø­Ù‚Ù‚ 30% Ø±Ø¨Ø­', target: 65000, reward: 300000, completed: false}
            ]
        };

        // Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let marketPrices = {};
        let priceHistory = {};
        let newsItems = [];
        let selectedStock = null;
        let stockChart = null;
        let gameInterval = null;

        // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø· Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª
        const sectorCorrelations = {
            banks: {banks: 1, petrochemical: 0.3, telecom: 0.2, retail: 0.1},
            petrochemical: {banks: 0.3, petrochemical: 1, energy: 0.6, industrial: 0.4},
            telecom: {banks: 0.2, telecom: 1, media: 0.5},
            retail: {retail: 1, realestate: 0.3}
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function initGame() {
            loadGameState();
            initializePrices();
            renderStocks();
            renderPortfolio();
            renderChallenges();
            renderPendingOrders();
            updatePortfolioDisplay();
            generateInitialNews();
            startGameLoop();
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
        function initializePrices() {
            STOCKS.forEach(stock => {
                marketPrices[stock.symbol] = stock.basePrice;
                priceHistory[stock.symbol] = [{price: stock.basePrice, time: 0}];
            });
        }

        // Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function startGameLoop() {
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                updateMarketPrices();
                checkPendingOrders();
                updatePortfolioDisplay();
                gameState.hour += 1;
                if (gameState.hour >= 17) {
                    gameState.hour = 10;
                    gameState.day += 1;
                    generateDailyNews();
                }
                updateTimeDisplay();
                renderStocks();
                saveGameState();
            }, 1000); // 1 Ø«Ø§Ù†ÙŠØ© = Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ = 7 Ø«ÙˆØ§Ù†ÙŠ)
        }

        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GBM
        function updateMarketPrices() {
            const dt = 1/252; // ÙŠÙˆÙ… ØªØ¯Ø§ÙˆÙ„ ÙˆØ§Ø­Ø¯
            const sectorShocks = {};
            
            // ØªÙˆÙ„ÙŠØ¯ ØµØ¯Ù…Ø§Øª Ù‚Ø·Ø§Ø¹ÙŠØ©
            Object.keys(SECTORS).forEach(sector => {
                sectorShocks[sector] = Math.random() < 0.05 ? (Math.random() - 0.5) * 0.1 : 0;
            });

            STOCKS.forEach(stock => {
                const S = marketPrices[stock.symbol];
                const mu = stock.mu;
                const sigma = stock.sigma;
                
                // Ø­Ø±ÙƒØ© Ø¨Ø±Ø§ÙˆÙ†ÙŠØ©
                const Z = boxMullerRandom();
                const drift = mu * dt;
                const diffusion = sigma * Math.sqrt(dt) * Z;
                
                // ØµØ¯Ù…Ø© Ù‚Ø·Ø§Ø¹ÙŠØ©
                const sectorShock = sectorShocks[stock.sector] || 0;
                
                // ØµØ¯Ù…Ø© Ø£Ø®Ø¨Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                const newsShock = Math.random() < 0.01 ? (Math.random() - 0.5) * 0.15 : 0;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const priceChange = drift + diffusion + sectorShock + newsShock;
                let newPrice = S * Math.exp(priceChange);
                
                // Ø­Ø¯ Ø£Ø¯Ù†Ù‰ ÙˆØ£Ø¹Ù„Ù‰ Ù„Ù„ØªØºÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ (10%)
                newPrice = Math.max(S * 0.9, Math.min(S * 1.1, newPrice));
                newPrice = Math.round(newPrice * 100) / 100;
                
                marketPrices[stock.symbol] = newPrice;
                priceHistory[stock.symbol].push({
                    price: newPrice,
                    time: gameState.day * 7 + (gameState.hour - 10)
                });
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 100 Ù†Ù‚Ø·Ø© ÙÙ‚Ø·
                if (priceHistory[stock.symbol].length > 100) {
                    priceHistory[stock.symbol].shift();
                }
            });
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ (Box-Muller)
        function boxMullerRandom() {
            const u1 = Math.random();
            const u2 = Math.random();
            return Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
        }

        // ÙØ­Øµ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        function checkPendingOrders() {
            gameState.pendingOrders = gameState.pendingOrders.filter(order => {
                const currentPrice = marketPrices[order.symbol];
                let shouldExecute = false;

                if (order.type === 'limit') {
                    if (order.side === 'buy' && currentPrice <= order.price) {
                        shouldExecute = true;
                    } else if (order.side === 'sell' && currentPrice >= order.price) {
                        shouldExecute = true;
                    }
                }

                if (shouldExecute) {
                    executeOrder(order.side, order.symbol, order.quantity, currentPrice);
                    return false;
                }
                return true;
            });
            renderPendingOrders();
        }

        // ØªÙ†ÙÙŠØ° Ø£Ù…Ø±
        function executeOrder(side, symbol, quantity, price) {
            const slippage = (Math.random() - 0.5) * 0.002; // Â±0.2%
            const executionPrice = price * (1 + slippage);
            const totalValue = executionPrice * quantity;
            const commission = totalValue * 0.00155;

            if (side === 'buy') {
                const totalCost = totalValue + commission;
                if (gameState.cash >= totalCost) {
                    gameState.cash -= totalCost;
                    gameState.holdings[symbol] = (gameState.holdings[symbol] || 0) + quantity;
                    
                    gameState.tradeHistory.unshift({
                        date: `Ø§Ù„ÙŠÙˆÙ… ${gameState.day} - ${gameState.hour}:00`,
                        symbol: symbol,
                        side: 'Ø´Ø±Ø§Ø¡',
                        quantity: quantity,
                        price: executionPrice.toFixed(2),
                        total: totalCost.toFixed(2)
                    });
                }
            } else if (side === 'sell') {
                if (gameState.holdings[symbol] >= quantity) {
                    const totalRevenue = totalValue - commission;
                    gameState.cash += totalRevenue;
                    gameState.holdings[symbol] -= quantity;
                    
                    if (gameState.holdings[symbol] === 0) {
                        delete gameState.holdings[symbol];
                    }
                    
                    gameState.tradeHistory.unshift({
                        date: `Ø§Ù„ÙŠÙˆÙ… ${gameState.day} - ${gameState.hour}:00`,
                        symbol: symbol,
                        side: 'Ø¨ÙŠØ¹',
                        quantity: quantity,
                        price: executionPrice.toFixed(2),
                        total: totalRevenue.toFixed(2)
                    });
                }
            }

            checkChallenges();
            updatePortfolioDisplay();
            renderPortfolio();
            renderTradeHistory();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù‡Ù…
        function renderStocks() {
            const container = document.getElementById('stocksList');
            const filterButtons = document.querySelectorAll('.filter-btn');
            let activeFilter = 'all';
            
            filterButtons.forEach(btn => {
                if (btn.classList.contains('active')) {
                    activeFilter = btn.textContent.trim() === 'Ø§Ù„ÙƒÙ„' ? 'all' : 
                                   btn.textContent.trim() === 'Ø§Ù„Ø¨Ù†ÙˆÙƒ' ? 'banks' :
                                   btn.textContent.trim() === 'Ø§Ù„Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª' ? 'petrochemical' :
                                   btn.textContent.trim() === 'Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª' ? 'telecom' :
                                   btn.textContent.trim() === 'Ø§Ù„ØªØ¬Ø²Ø¦Ø©' ? 'retail' :
                                   btn.textContent.trim() === 'Ø§Ù„ØªØ£Ù…ÙŠÙ†' ? 'insurance' : 'all';
                }
            });

            let filteredStocks = STOCKS;
            if (activeFilter !== 'all') {
                filteredStocks = STOCKS.filter(s => s.sector === activeFilter);
            }

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredStocks = filteredStocks.filter(s => 
                    s.name.includes(searchTerm) || s.symbol.includes(searchTerm)
                );
            }

            container.innerHTML = filteredStocks.map(stock => {
                const currentPrice = marketPrices[stock.symbol];
                const change = ((currentPrice - stock.basePrice) / stock.basePrice * 100).toFixed(2);
                const changeClass = change >= 0 ? 'profit' : 'loss';
                const changeSymbol = change >= 0 ? '+' : '';

                return `
                    <div class="stock-item" onclick="openTradeModal('${stock.symbol}')">
                        <div>
                            <div class="stock-name">${stock.name}</div>
                            <div class="stock-symbol">${stock.symbol} - ${SECTORS[stock.sector]}</div>
                        </div>
                        <div class="stock-price">${currentPrice.toFixed(2)}</div>
                        <div class="stock-change ${changeClass}" style="background: ${change >= 0 ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)'}">
                            ${changeSymbol}${change}%
                        </div>
                        <div style="text-align: center;">
                            <button class="action-btn" onclick="event.stopPropagation(); openTradeModal('${stock.symbol}')">ØªØ¯Ø§ÙˆÙ„</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø³Ù‡Ù…
        function filterStocks(sector) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderStocks();
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø³Ù‡Ù…
        function searchStocks() {
            renderStocks();
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„
        function openTradeModal(symbol) {
            selectedStock = STOCKS.find(s => s.symbol === symbol);
            if (!selectedStock) return;

            document.getElementById('modalTitle').textContent = `${selectedStock.name} (${selectedStock.symbol})`;
            document.getElementById('tradeModal').classList.add('active');
            document.getElementById('currentPrice').textContent = marketPrices[symbol].toFixed(2) + ' Ø±ÙŠØ§Ù„';
            
            renderStockChart(symbol);
            updateOrderForm();
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„
        function closeModal() {
            document.getElementById('tradeModal').classList.remove('active');
            selectedStock = null;
        }

        // Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        function renderStockChart(symbol) {
            const ctx = document.getElementById('stockChart').getContext('2d');
            const history = priceHistory[symbol] || [];

            if (stockChart) {
                stockChart.destroy();
            }

            stockChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => ''),
                    datasets: [{
                        label: 'Ø§Ù„Ø³Ø¹Ø±',
                        data: history.map(h => h.price),
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {display: false}
                    },
                    scales: {
                        y: {
                            ticks: {color: '#fff'},
                            grid: {color: 'rgba(255, 255, 255, 0.1)'}
                        },
                        x: {
                            display: false
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù…Ø±
        function updateOrderForm() {
            const orderType = document.getElementById('orderType').value;
            const limitPriceGroup = document.getElementById('limitPriceGroup');
            
            if (orderType === 'limit') {
                limitPriceGroup.style.display = 'block';
            } else {
                limitPriceGroup.style.display = 'none';
            }
            
            updateOrderSummary();
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ù…Ø±
        function updateOrderSummary() {
            if (!selectedStock) return;

            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            const orderType = document.getElementById('orderType').value;
            let price = marketPrices[selectedStock.symbol];
            
            if (orderType === 'limit') {
                price = parseFloat(document.getElementById('limitPrice').value) || price;
            }

            const totalValue = price * quantity;
            const commission = totalValue * 0.00155;
            const finalTotal = totalValue + commission;

            document.getElementById('currentPrice').textContent = marketPrices[selectedStock.symbol].toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('totalValue').textContent = totalValue.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('commission').textContent = commission.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('finalTotal').textContent = finalTotal.toFixed(2) + ' Ø±ÙŠØ§Ù„';
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø±
        function submitOrder(event) {
            event.preventDefault();
            if (!selectedStock) return;

            const action = event.submitter.dataset.action;
            const quantity = parseInt(document.getElementById('quantity').value);
            const orderType = document.getElementById('orderType').value;
            let price = marketPrices[selectedStock.symbol];

            if (orderType === 'limit') {
                price = parseFloat(document.getElementById('limitPrice').value);
                if (!price || price <= 0) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ù…Ø­Ø¯Ø¯ ØµØ­ÙŠØ­');
                    return;
                }
            }

            if (!quantity || quantity <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©');
                return;
            }

            if (action === 'buy') {
                const totalCost = price * quantity * 1.00155;
                if (gameState.cash < totalCost) {
                    alert('Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ');
                    return;
                }

                if (orderType === 'market') {
                    executeOrder('buy', selectedStock.symbol, quantity, price);
                } else {
                    gameState.pendingOrders.push({
                        type: 'limit',
                        side: 'buy',
                        symbol: selectedStock.symbol,
                        quantity: quantity,
                        price: price
                    });
                }
            } else if (action === 'sell') {
                const holdings = gameState.holdings[selectedStock.symbol] || 0;
                if (holdings < quantity) {
                    alert('Ù„Ø§ ØªÙ…Ù„Ùƒ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø³Ù‡Ù…');
                    return;
                }

                if (orderType === 'market') {
                    executeOrder('sell', selectedStock.symbol, quantity, price);
                } else {
                    gameState.pendingOrders.push({
                        type: 'limit',
                        side: 'sell',
                        symbol: selectedStock.symbol,
                        quantity: quantity,
                        price: price
                    });
                }
            }

            closeModal();
            document.getElementById('quantity').value = '';
            document.getElementById('limitPrice').value = '';
            saveGameState();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ÙØ¸Ø©
        function renderPortfolio() {
            const container = document.getElementById('holdingsList');
            const holdings = Object.keys(gameState.holdings);

            if (holdings.length === 0) {
                container.innerHTML = '<div style="text-align: center; opacity: 0.6; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>';
                return;
            }

            container.innerHTML = holdings.map(symbol => {
                const stock = STOCKS.find(s => s.symbol === symbol);
                const quantity = gameState.holdings[symbol];
                const currentPrice = marketPrices[symbol];
                const value = (currentPrice * quantity).toFixed(2);

                return `
                    <div class="holding-item">
                        <div>
                            <div style="font-weight: bold;">${stock.name}</div>
                            <div style="font-size: 11px; opacity: 0.7;">${symbol}</div>
                        </div>
                        <div style="text-align: center;">
                            <div>${quantity} Ø³Ù‡Ù…</div>
                            <div style="font-size: 12px; opacity: 0.7;">${currentPrice.toFixed(2)} Ø±ÙŠØ§Ù„</div>
                        </div>
                        <div style="text-align: left; font-weight: bold;">${value} Ø±ÙŠØ§Ù„</div>
                    </div>
                `;
            }).join('');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ÙØ¸Ø©
        function updatePortfolioDisplay() {
            let portfolioValue = gameState.cash;
            
            Object.keys(gameState.holdings).forEach(symbol => {
                const quantity = gameState.holdings[symbol];
                const price = marketPrices[symbol];
                portfolioValue += price * quantity;
            });

            const pl = portfolioValue - gameState.startCapital;
            const returnPct = (pl / gameState.startCapital * 100).toFixed(2);

            document.getElementById('cashDisplay').textContent = gameState.cash.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('portfolioValue').textContent = portfolioValue.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('plDisplay').textContent = pl.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('plDisplay').className = 'stat-value ' + (pl >= 0 ? 'profit' : 'loss');
            document.getElementById('returnDisplay').textContent = (returnPct >= 0 ? '+' : '') + returnPct + '%';
            document.getElementById('returnDisplay').className = 'stat-value ' + (pl >= 0 ? 'profit' : 'loss');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª
        function renderChallenges() {
            const container = document.getElementById('challengesList');
            const portfolioValue = gameState.cash + Object.keys(gameState.holdings).reduce((sum, symbol) => {
                return sum + (marketPrices[symbol] * gameState.holdings[symbol]);
            }, 0);

            container.innerHTML = gameState.challenges.map(challenge => {
                const progress = Math.min(100, (portfolioValue / challenge.target) * 100);
                const completed = challenge.completed;

                return `
                    <div class="challenge-item" style="opacity: ${completed ? 0.6 : 1}">
                        <div class="challenge-title">${completed ? 'âœ“ ' : ''}${challenge.title}</div>
                        <div style="font-size: 12px; opacity: 0.8;">
                            Ø§Ù„Ù‡Ø¯Ù: ${challenge.target.toLocaleString()} Ø±ÙŠØ§Ù„
                            ${challenge.reward > 0 ? ` | Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: ${challenge.reward.toLocaleString()} Ø±ÙŠØ§Ù„` : ''}
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 5px;">
                            ${progress.toFixed(1)}% Ù…ÙƒØªÙ…Ù„
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ÙØ­Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª
        function checkChallenges() {
            const portfolioValue = gameState.cash + Object.keys(gameState.holdings).reduce((sum, symbol) => {
                return sum + (marketPrices[symbol] * gameState.holdings[symbol]);
            }, 0);

            gameState.challenges.forEach(challenge => {
                if (!challenge.completed && portfolioValue >= challenge.target) {
                    challenge.completed = true;
                    if (challenge.reward > 0) {
                        gameState.cash += challenge.reward;
                        gameState.startCapital += challenge.reward;
                        alert(`ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ: ${challenge.title}\nØ­ØµÙ„Øª Ø¹Ù„Ù‰ ${challenge.reward.toLocaleString()} Ø±ÙŠØ§Ù„!`);
                    }
                }
            });

            renderChallenges();
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        function generateInitialNews() {
            const newsTemplates = [
                {text: 'Ø§ÙØªØªØ§Ø­ Ø§Ù„Ø³ÙˆÙ‚ Ø¨Ø£Ø¯Ø§Ø¡ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù…ØªØ£Ø«Ø±Ø§Ù‹ Ø¨Ø§Ø±ØªÙØ§Ø¹ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù†ÙØ·', impact: 'medium', sector: 'energy'},
                {text: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙŠØ´Ù‡Ø¯ ØªØ¯Ø§ÙˆÙ„Ø§Øª Ù†Ø´Ø·Ø© Ø¨Ø¹Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙØµÙ„ÙŠØ©', impact: 'high', sector: 'banks'},
                {text: 'ØªÙˆÙ‚Ø¹Ø§Øª Ø¨Ù†Ù…Ùˆ Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¬Ø²Ø¦Ø© Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø¨ Ù…ÙˆØ³Ù… Ø§Ù„Ø£Ø¹ÙŠØ§Ø¯', impact: 'low', sector: 'retail'}
            ];

            newsItems = newsTemplates.map((template, index) => ({
                id: Date.now() + index,
                title: template.text,
                time: `Ø§Ù„ÙŠÙˆÙ… ${gameState.day}`,
                impact: template.impact,
                sector: template.sector
            }));

            renderNews();
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø£Ø®Ø¨Ø§Ø± ÙŠÙˆÙ…ÙŠØ©
        function generateDailyNews() {
            const newsTemplates = [
                {text: 'Ø§Ø±ØªÙØ§Ø¹ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù†ÙØ· ÙŠØ¯Ø¹Ù… Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø·Ø§Ù‚Ø©', impact: 'high', sector: 'energy'},
                {text: 'Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ù…Ø­Ù„ÙŠØ© ØªØ¹Ù„Ù† Ø¹Ù† Ø£Ø±Ø¨Ø§Ø­ Ù‚ÙŠØ§Ø³ÙŠØ©', impact: 'high', sector: 'banks'},
                {text: 'Ù†Ù…Ùˆ Ù‚ÙˆÙŠ ÙÙŠ Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª', impact: 'medium', sector: 'telecom'},
                {text: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¬Ø²Ø¦Ø© ÙŠÙˆØ§Ø¬Ù‡ ØªØ­Ø¯ÙŠØ§Øª Ù…Ù†Ø§ÙØ³Ø©', impact: 'medium', sector: 'retail'},
                {text: 'Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø£Ø³Ù…Ù†Øª ØªØ³ØªÙÙŠØ¯ Ù…Ù† Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©', impact: 'medium', sector: 'cement'},
                {text: 'ØªØ±Ø§Ø¬Ø¹ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¨ØªØ±ÙˆÙƒÙŠÙ…Ø§ÙˆÙŠØ§Øª', impact: 'high', sector: 'petrochemical'},
                {text: 'Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ† ØªØ­Ù‚Ù‚ Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©', impact: 'low', sector: 'insurance'},
                {text: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙŠØ´Ù‡Ø¯ Ø§Ù†ØªØ¹Ø§Ø´Ø§Ù‹ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨', impact: 'medium', sector: 'realestate'},
                {text: 'Ø§Ø±ØªÙØ§Ø¹ Ø­Ø±ÙƒØ© Ø§Ù„Ø³ÙØ± ÙŠØ¯Ø¹Ù… Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù†Ù‚Ù„', impact: 'low', sector: 'transport'},
                {text: 'Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø²Ø±Ø§Ø¹Ø© ØªÙˆØ§Ø¬Ù‡ ØªØ­Ø¯ÙŠØ§Øª Ù…Ù†Ø§Ø®ÙŠØ©', impact: 'medium', sector: 'agriculture'},
                {text: 'Ù‚Ø·Ø§Ø¹ Ø§Ù„ØµÙ†Ø§Ø¹Ø© ÙŠØ³ØªÙÙŠØ¯ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø­Ù„ÙŠ', impact: 'low', sector: 'industrial'},
                {text: 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ¨Ø±Ù‰ ØªØ¯Ø¹Ù… Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ´ÙŠÙŠØ¯', impact: 'medium', sector: 'building'}
            ];

            if (Math.random() < 0.3) { // 30% Ø§Ø­ØªÙ…Ø§Ù„ Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯ ÙŠÙˆÙ…ÙŠØ§Ù‹
                const template = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
                const newNews = {
                    id: Date.now(),
                    title: template.text,
                    time: `Ø§Ù„ÙŠÙˆÙ… ${gameState.day}`,
                    impact: template.impact,
                    sector: template.sector
                };

                newsItems.unshift(newNews);
                if (newsItems.length > 10) {
                    newsItems.pop();
                }

                renderNews();
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        function renderNews() {
            const container = document.getElementById('newsList');
            
            if (newsItems.length === 0) {
                container.innerHTML = '<div style="text-align: center; opacity: 0.6; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø±</div>';
                return;
            }

            container.innerHTML = newsItems.map(news => {
                const impactClass = `impact-${news.impact}`;
                const impactText = news.impact === 'high' ? 'Ø¹Ø§Ù„ÙŠ' : news.impact === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶';

                return `
                    <div class="news-item">
                        <div class="news-title">
                            <span class="impact-badge ${impactClass}">ØªØ£Ø«ÙŠØ± ${impactText}</span>
                            ${news.title}
                        </div>
                        <div class="news-meta">
                            <span>${news.time}</span>
                            <span>${SECTORS[news.sector] || 'Ø¹Ø§Ù…'}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        function renderPendingOrders() {
            const container = document.getElementById('pendingOrdersList');
            
            if (gameState.pendingOrders.length === 0) {
                container.innerHTML = '<div style="text-align: center; opacity: 0.6; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ø¹Ù„Ù‚Ø©</div>';
                return;
            }

            container.innerHTML = gameState.pendingOrders.map((order, index) => {
                const stock = STOCKS.find(s => s.symbol === order.symbol);
                const sideText = order.side === 'buy' ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹';
                const sideClass = order.side === 'buy' ? 'profit' : 'loss';

                return `
                    <div class="order-item">
                        <div>
                            <div style="font-weight: bold;">${stock.name}</div>
                            <div style="font-size: 12px; opacity: 0.7;">
                                <span class="${sideClass}">${sideText}</span> ${order.quantity} Ø³Ù‡Ù… @ ${order.price.toFixed(2)} Ø±ÙŠØ§Ù„
                            </div>
                        </div>
                        <button class="cancel-order-btn" onclick="cancelOrder(${index})">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                `;
            }).join('');
        }

        // Ø¥Ù„ØºØ§Ø¡ Ø£Ù…Ø± Ù…Ø¹Ù„Ù‚
        function cancelOrder(index) {
            gameState.pendingOrders.splice(index, 1);
            renderPendingOrders();
            saveGameState();
        }

        // Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª
        function renderTradeHistory() {
            const container = document.getElementById('tradeHistoryList');
            
            if (gameState.tradeHistory.length === 0) {
                container.innerHTML = '<div style="text-align: center; opacity: 0.6; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª</div>';
                return;
            }

            container.innerHTML = gameState.tradeHistory.slice(0, 50).map(trade => {
                const stock = STOCKS.find(s => s.symbol === trade.symbol);
                const sideClass = trade.side === 'Ø´Ø±Ø§Ø¡' ? 'profit' : 'loss';

                return `
                    <div class="order-item">
                        <div>
                            <div style="font-weight: bold;">${stock.name} (${trade.symbol})</div>
                            <div style="font-size: 12px; opacity: 0.7;">
                                ${trade.date} - <span class="${sideClass}">${trade.side}</span> ${trade.quantity} Ø³Ù‡Ù… @ ${trade.price} Ø±ÙŠØ§Ù„
                            </div>
                        </div>
                        <div style="text-align: left; font-weight: bold;">
                            ${trade.total} Ø±ÙŠØ§Ù„
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tab === 'orders') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('ordersTab').classList.add('active');
                renderPendingOrders();
            } else if (tab === 'history') {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('historyTab').classList.add('active');
                renderTradeHistory();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª
        function updateTimeDisplay() {
            const timeMap = {
                10: '10:00 ØµØ¨Ø§Ø­Ø§Ù‹',
                11: '11:00 ØµØ¨Ø§Ø­Ø§Ù‹',
                12: '12:00 Ø¸Ù‡Ø±Ø§Ù‹',
                13: '01:00 Ù…Ø³Ø§Ø¡Ù‹',
                14: '02:00 Ù…Ø³Ø§Ø¡Ù‹',
                15: '03:00 Ù…Ø³Ø§Ø¡Ù‹',
                16: '04:00 Ù…Ø³Ø§Ø¡Ù‹'
            };

            document.getElementById('marketTime').textContent = timeMap[gameState.hour] || 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³ÙˆÙ‚';
            document.getElementById('marketDay').textContent = `Ø§Ù„ÙŠÙˆÙ… ${gameState.day}`;
        }

        // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function saveGameState() {
            try {
                localStorage.setItem('saudiStockGameState', JSON.stringify({
                    cash: gameState.cash,
                    holdings: gameState.holdings,
                    pendingOrders: gameState.pendingOrders,
                    tradeHistory: gameState.tradeHistory,
                    day: gameState.day,
                    hour: gameState.hour,
                    startCapital: gameState.startCapital,
                    challenges: gameState.challenges,
                    marketPrices: marketPrices,
                    priceHistory: priceHistory,
                    newsItems: newsItems
                }));
            } catch (e) {
                console.error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function loadGameState() {
            try {
                const saved = localStorage.getItem('saudiStockGameState');
                if (saved) {
                    const data = JSON.parse(saved);
                    gameState.cash = data.cash || 50000;
                    gameState.holdings = data.holdings || {};
                    gameState.pendingOrders = data.pendingOrders || [];
                    gameState.tradeHistory = data.tradeHistory || [];
                    gameState.day = data.day || 1;
                    gameState.hour = data.hour || 10;
                    gameState.startCapital = data.startCapital || 50000;
                    gameState.challenges = data.challenges || gameState.challenges;
                    
                    if (data.marketPrices) {
                        marketPrices = data.marketPrices;
                    }
                    if (data.priceHistory) {
                        priceHistory = data.priceHistory;
                    }
                    if (data.newsItems) {
                        newsItems = data.newsItems;
                    }
                }
            } catch (e) {
                console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGame() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.')) {
                localStorage.removeItem('saudiStockGameState');
                location.reload();
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        window.addEventListener('DOMContentLoaded', () => {
            const header = document.querySelector('.header');
            const resetBtn = document.createElement('button');
            resetBtn.className = 'action-btn';
            resetBtn.textContent = 'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†';
            resetBtn.onclick = resetGame;
            resetBtn.style.background = 'rgba(244, 67, 54, 0.3)';
            header.appendChild(resetBtn);
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', initGame);

        // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', saveGameState);
    </script>
</body>
</html>